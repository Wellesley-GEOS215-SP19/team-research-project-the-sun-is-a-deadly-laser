%% The Sun is a Deadly Laser: A GEOS 215 Project
% Jocelyn and Leafia

%% Read in global radiation data from MIDAS

%observed years (1947 - 2019)
obs_years = NaN*zeros(72,1); 
for i=1:length(obs_years)
    obs_years(i) = 1946 + (i);
end

%%
%load in station ids
load station_ids.mat

station_data=cell2mat(table2cell(station_ids));
%%
load radiation_data.mat

%rad_data = table2cell(radiation_data);
%%
station_grid = unique(radiation_data.SRC_ID);
month_grid = unique(month(radiation_data.OB_END_TIME));
stations = NaN*zeros((length(station_grid)),3);
%%
for i = 1:length(station_data)
    stationIDindex = find(station_grid==station_data(i,3));
    stations(stationIDindex,1) = station_data(stationIDindex,3);%station ids
    stations(stationIDindex,2) = station_data(stationIDindex,2);%lat
    stations(stationIDindex,3) = station_data(stationIDindex,1);%lon
end

stat_lat = stations(:,2);
stat_lon = stations(:,3);
%%

%%

global_rad = NaN*zeros(length(stations(:,1)),length(stations(:,2)),length(month_grid));

for i= 1:length(radiation_data.SRC_ID)
           stat_index = find(stations(i,1)==radiation_data.SRC_ID(i));
           if stations(i,1)==radiation_data.SRC_ID(i);
               radiation_data.LAT(i)= stations(i,2);
               radiation_data.LON(i) = stations(i,3);
           else
               %do nothing
           end
           global_rad(lonindex,latindex,)=CO2data.PCO2_SW(i);
end%<--
           %global_rad(,latindex,CO2data.MONTH(i))=CO2data.PCO2_SW(i);
           %SST(lonindex,latindex,CO2data.MONTH(i))=CO2data.SST(i);
end%<--

%%
figure(2); clf
worldmap world
load coastlines;
contourfm(stat_lat, stat_lon, alb_mean','linecolor','none');
cmocean('ice');
c = colorbar('southoutside'); 
c.Label.String = 'albedo in percent';
plotm(coastlat, coastlon, 'Color','white','LineWidth',1);
%geoshow('landareas.shp','FaceColor','black');
title('Mean albedo between Nov 1986 and Jan 1987')
%% Read in temp data from GISS data

%GISS_temp = readtable('GISS_temp.csv');

%% Read in albedo
% X, Y, T, albedo
% X = longitude in degrees east
% Y = latitude in degrees north
% T = time in months since 1960-01-01 (data from Nov 1986, Dec 1986, and
% Jan 1987)
% albedo = in percent, missing values are replaced with 999.99
lon_alb = double(ncread('albedo.nc','X'));
lat_alb = double(ncread('albedo.nc','Y'));
time_alb = double(ncread('albedo.nc','T'));
alb = double(ncread('albedo.nc','albedo'));
%%
lon_alb_new=[lon_alb;lon_alb(1)+360];
alb(145,:,:)=alb(1,:,:); %to get rid of that annoying white line
%%
%trying to replace 999.9900 with global mean albedo 
for i=1:length(time_alb)
    for j=1:length(lon_alb_new)
        for k=1:length(lat_alb)
            if alb(j,k,i)>900;
                alb(j,k,i)= NaN ;
            end
        end
    end 
end

%%
alb_mean = mean(alb,3);


figure(1); clf
worldmap world
load coastlines;
contourfm(lat_alb, lon_alb_new, alb_mean','linecolor','none');
cmocean('ice');
c = colorbar('southoutside'); 
c.Label.String = 'albedo in percent';
plotm(coastlat, coastlon, 'Color','white','LineWidth',1);
%geoshow('landareas.shp','FaceColor','black');
title('Mean albedo between Nov 1986 and Jan 1987')

%%
%1D radiative transfer model

